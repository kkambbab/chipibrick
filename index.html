<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>ì‡¼ì¸ ì—ì„œ ë´¤ë˜ ê·¸ ê²Œì„ì„</title>
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        canvas {
            background: #eee;
            display: block;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        .video-container {
            position: relative;
            width: 900px;
            height: 180px;
            margin: 0 auto;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        #videoA {
            z-index: 1;
            opacity: 1;
            transition: opacity 0.2s ease;
        }

        #videoB {
            z-index: 2;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
    </style>
</head>

<body>
    <canvas id="gameCanvas" width="900" height="600"></canvas>

    <div style="width: 900px; margin: 10px auto; text-align: center;">
        ğŸ”Š ë³¼ë¥¨: <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5">
    </div>

    <div class="video-container" style="width: 900px; height: 180px;">
        <video id="videoA" autoplay muted loop>
            <source src="background.mp4" type="video/mp4">
        </video>
        <video id="videoB" autoplay muted loop>
            <source src="reaction.mp4" type="video/mp4">
        </video>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        class Ball {
            constructor(x, y, dx, dy, radius = 8) {
                this.x = x;
                this.y = y;
                this.dx = dx;
                this.dy = dy;
                this.radius = radius;
            }
            move() {
                this.x += this.dx;
                this.y += this.dy;
            }
            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "#0095DD";
                ctx.fill();
                ctx.closePath();
            }
        }

        class Item {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.radius = 10;
                this.type = type;
                this.dy = 2;
            }
            move() {
                this.y += this.dy;
            }
            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fillStyle = "#FFA500";
                ctx.fill();
                ctx.closePath();
                ctx.font = "10px Arial";
                ctx.fillStyle = "#000";
                ctx.textAlign = "center";
                ctx.fillText(this.type, this.x, this.y + 3);
            }
        }

        let balls = [new Ball(canvas.width / 2, canvas.height - 30, 4, -4)];
        let items = [];
        let paddleHeight = 10;
        let paddleWidth = 75;
        let paddleX = (canvas.width - paddleWidth) / 2;

        let brickRowCount = 5;
        let brickColumnCount = 10;
        let brickWidth = 60;
        let brickHeight = 16;
        let brickPadding = 10;
        let brickOffsetTop = 10;
        let brickOffsetLeft = 15;

        let score = 0;
        let bricks = [];

        for (let c = 0; c < brickColumnCount; c++) {
            bricks[c] = [];
            for (let r = 0; r < brickRowCount; r++) {
                bricks[c][r] = { x: 0, y: 0, status: 1 };
            }
        }

        document.addEventListener("mousemove", e => {
            const relativeX = e.clientX - canvas.getBoundingClientRect().left;
            if (relativeX > 0 && relativeX < canvas.width) {
                paddleX = relativeX - paddleWidth / 2;
            }
        });

        const videoA = document.getElementById("videoA");
        const videoB = document.getElementById("videoB");
        const volumeSlider = document.getElementById("volumeSlider");

        videoA.muted = false;
        videoB.muted = true;
        videoA.play().catch(() => { });

        volumeSlider.addEventListener("input", () => {
            const vol = parseFloat(volumeSlider.value);
            videoA.volume = vol;
            videoB.volume = vol;
        });
        videoA.volume = videoB.volume = volumeSlider.value;

        function reactionTrigger() {
            videoB.style.opacity = 1;
            videoA.muted = true;
            videoB.muted = false;
            if (window._videoTimeout) clearTimeout(window._videoTimeout);
            window._videoTimeout = setTimeout(() => {
                videoB.style.opacity = 0;
                videoA.muted = false;
                videoB.muted = true;
                videoA.play().catch(() => { });
            }, 400);
        }

        function collisionDetection() {
            balls.forEach(ball => {
                for (let c = 0; c < brickColumnCount; c++) {
                    for (let r = 0; r < brickRowCount; r++) {
                        const b = bricks[c][r];
                        if (b.status === 1) {
                            if (
                                ball.x + ball.radius > b.x &&
                                ball.x - ball.radius < b.x + brickWidth &&
                                ball.y + ball.radius > b.y &&
                                ball.y - ball.radius < b.y + brickHeight
                            ) {
                                ball.dy = -ball.dy;
                                b.status = 0;
                                score++;
                                reactionTrigger();
                                if (score === brickRowCount * brickColumnCount) {
                                    setTimeout(() => {
                                        alert("ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶ì¹˜í”¼ì¹˜í”¼ì°¨íŒŒì°¨íŒŒë‘ë¹„ë‘ë¹„ë‹¤ë°”ë‹¤ë°” ë§¤ì§€ì»¬ ë§ˆì´ ë‘ë¹„ë‘ë¹„ ë¶ë¶ë¶");
                                        document.location.reload();
                                    }, 100);
                                }

                                if (Math.random() < 0.3) {
                                    const types = ["+3", "x3", "<<->>", "-"];
                                    const randomType = types[Math.floor(Math.random() * types.length)];
                                    items.push(new Item(b.x + brickWidth / 2, b.y + brickHeight / 2, randomType));
                                }
                            }
                        }
                    }
                }
            });
        }

        function applyItemEffect(type) {
            switch (type) {
                case "+3":
                    for (let i = 0; i < 3; i++) {
                        balls.push(new Ball(paddleX + paddleWidth / 2, canvas.height - 20, (Math.random() - 0.5) * 4, -4));
                    }
                    break;
                case "x3":
                    let newBalls = [];
                    balls.forEach(b => {
                        for (let i = 0; i < 2; i++) {
                            newBalls.push(new Ball(b.x, b.y, -b.dx + Math.random(), -b.dy + Math.random()));
                        }
                    });
                    balls = balls.concat(newBalls);
                    break;
                case "<<->>":
                    paddleWidth += 20;
                    if (paddleWidth > canvas.width) paddleWidth = canvas.width - 10;
                    break;
                case "-":
                    paddleWidth -= 20;
                    if (paddleWidth < 30) paddleWidth = 30;
                    break;
            }
        }

        function checkItemCollisions() {
            items = items.filter(item => {
                if (
                    item.y + item.radius > canvas.height - paddleHeight &&
                    item.x > paddleX &&
                    item.x < paddleX + paddleWidth
                ) {
                    applyItemEffect(item.type);
                    return false;
                }
                return item.y < canvas.height;
            });
        }

        function drawBricks() {
            for (let c = 0; c < brickColumnCount; c++) {
                for (let r = 0; r < brickRowCount; r++) {
                    if (bricks[c][r].status === 1) {
                        let brickX = c * (brickWidth + brickPadding) + brickOffsetLeft;
                        let brickY = r * (brickHeight + brickPadding) + brickOffsetTop;
                        bricks[c][r].x = brickX;
                        bricks[c][r].y = brickY;
                        ctx.beginPath();
                        ctx.rect(brickX, brickY, brickWidth, brickHeight);
                        ctx.fillStyle = "#FF5733";
                        ctx.fill();
                        ctx.closePath();
                    }
                }
            }
        }

        function drawPaddle() {
            ctx.beginPath();
            ctx.rect(paddleX, canvas.height - paddleHeight, paddleWidth, paddleHeight);
            ctx.fillStyle = "#0095DD";
            ctx.fill();
            ctx.closePath();
        }

        function drawScore() {
            ctx.font = "16px Arial";
            ctx.fillStyle = "#000";
            ctx.fillText("ì ìˆ˜: " + score, 8, 20);
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBricks();
            balls.forEach(ball => ball.draw(ctx));
            drawPaddle();
            drawScore();
            items.forEach(item => item.draw(ctx));
            collisionDetection();
            checkItemCollisions();

            balls.forEach(ball => {
                if (ball.x + ball.dx > canvas.width - ball.radius || ball.x + ball.dx < ball.radius) ball.dx = -ball.dx;
                if (ball.y + ball.dy < ball.radius) ball.dy = -ball.dy;
                else if (ball.y + ball.dy > canvas.height - ball.radius) {
                    if (ball.x + ball.radius > paddleX && ball.x - ball.radius < paddleX + paddleWidth) {
                        let paddleCenter = paddleX + paddleWidth / 2;
                        let hitPos = (ball.x - paddleCenter) / (paddleWidth / 2);
                        let angle = hitPos * (Math.PI / 3);
                        let speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
                        ball.dx = speed * Math.sin(angle);
                        ball.dy = -speed * Math.cos(angle);
                    } else {
                        balls = balls.filter(b => b !== ball);
                    }
                }
                ball.move();
            });

            items.forEach(item => item.move());

            if (balls.length === 0) {
                alert("ìš°ë¥´ë¥´...ì• ì˜­....ìš°ë¥´ë¥´ë¥´ë¥´.....ì• ë¡.....ìš¸,ë¥´ã…¡ë¥´ë¦‰ ì• ë¡...ì• ì˜­,,,,,ì•©,,,,ìš°ë¥µ....ì•©...");
                document.location.reload();
            }

            requestAnimationFrame(draw);
        }

        draw();

        document.addEventListener("click", () => {
            if (videoA.paused) {
                videoA.play().catch(() => { });
            }
        }, { once: true });
    </script>
</body>

</html>